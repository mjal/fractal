// Generated by CoffeeScript 1.6.3
(function() {
  var N, c, canvas, ctx, downX, downY, draw, f, iteration_max, n2, p, upX, upY, updateC, x1, x2, y1, y2, zoom, zoom_x, zoom_y;

  canvas = document.querySelector("canvas");

  ctx = canvas.getContext("2d");

  iteration_max = 50;

  x1 = -2.1;

  y1 = -1.2;

  x2 = 0.6;

  y2 = 1.2;

  zoom_x = canvas.width / (x2 - x1);

  zoom_y = canvas.height / (y2 - y1);

  f = function(c, z) {
    return {
      x: z.x * z.x - z.y * z.y + c.x,
      y: 2 * z.y * z.x + c.y
    };
  };

  n2 = function(z) {
    return z.x * z.x + z.y * z.y;
  };

  p = {
    x: -0,
    y: -0
  };

  c = [
    {
      x: 0.285,
      y: 0
    }, {
      y: 0,
      x: 1 - 1.6180339887
    }, {
      x: 0.4,
      y: 0.6
    }, {
      x: 0.285,
      y: 0.01
    }
  ];

  draw = function(p, zoom, c) {
    var i, j, n, z, _results;
    ctx.fillStyle = "rgb(0,0,0)";
    i = 0;
    _results = [];
    while (i < canvas.width) {
      j = 0;
      while (j < canvas.height) {
        z = {
          x: p.x + i * zoom / canvas.width,
          y: p.y + j * zoom / canvas.height
        };
        n = 0;
        while (++n < iteration_max && n2(z) < 4) {
          z = f(c, z);
        }
        if (n === iteration_max) {
          ctx.fillRect(i, j, 1, 1);
        }
        j++;
      }
      _results.push(i++);
    }
    return _results;
  };

  zoom = 1;

  N = 0;

  draw(p, zoom, c[N]);

  upX = upY = downX = downY = false;

  document.addEventListener('keyup', (function(e) {
    var char;
    char = e.which || e.keyCode;
    console.log('keypress:' + char);
    if (char === 39) {
      p.x += 0.1;
    }
    if (char === 37) {
      p.x -= 0.1;
    }
    if (char === 40) {
      p.y += 0.1;
    }
    if (char === 38) {
      p.y -= 0.1;
    }
    if (char === 32) {
      zoom *= 0.9;
    }
    if (char === 88) {
      zoom *= 1.1;
    }
    if (char === 87) {
      N = N + 1 % c.length;
    }
    if (char === 65) {
      upX = true;
    }
    if (char === 90) {
      downX = true;
    }
    if (char === 81) {
      upY = true;
    }
    if (char === 83) {
      downY = true;
    }
    ctx.fillStyle = "rgb(255,255,255)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    updateC();
    return draw(p, zoom, c[N]);
  }), false);

  updateC = function() {
    if (upX) {
      c[N].x += 0.01;
    }
    if (upY) {
      c[N].y += 0.01;
    }
    if (downX) {
      c[N].x -= 0.01;
    }
    if (downY) {
      c[N].y -= 0.01;
    }
    return upX = upY = downX = downY = false;
  };

}).call(this);
